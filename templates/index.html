{% extends "root.html" %}
{% block head %}
	<link href="/feed.rss" type="application/rss+xml" rel="alternate" title="RSS feed">
{% endblock %}

{% block content %}
	{% if articles.is_empty() %}
		<article>
			No articles yet.
			{% match session %}
			{% when Some with (session) %}
				{% if session.allowed(Permission::CreateArticle, connection).unwrap_or(false) %}
					<p><a href="/edit">Write a new one?</a>
				{% endif %}
			{% when None %}
			{% endmatch %}
		</article>
	{% endif %}
	{% for article in articles %}
		{% if article.viewable(session, connection).unwrap_or(false) %}
		<article>
			<header>
				<h1><a href="/article/{{ article.url }}">{{ article.title }}</a></h1>
				<time title="{{ article.date.format("%c") }}" datetime="{{ article.date.format("%F %T") }}">
					{{ article.date.format("%d %b %Y - %H:%M") }}
				</time>
			</header>
			{{ article.preview()|safe }}

			<p><a href="/article/{{ article.url }}">Read more ({{ article.comment_count(connection).unwrap_or_default() }} comments)</a></p>
		</article>
		{% endif %}
	{% endfor %}
{% endblock %}
